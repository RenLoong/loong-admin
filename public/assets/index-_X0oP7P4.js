import{_ as ze}from"./layouts-copyright-DKtsp8N0.js";import{e as K,B as $e,r as S,o as Be,a as Ue,g,j as i,A as p,b1 as Ce,k as a,s as e,n as H,J as we,p as d,G as Ee,t as _,ad as qe,i as U,h as r,b2 as be,D as Le,f as ke,ab as Fe,I as Ne,a8 as Me,F as J,l as Pe,m as B,a9 as Ae,W as De,E as G,T as Qe,S as We}from"./vendor-DSBT_m9f.js";import{i as k,j as Ge,s as je,d as Oe,k as Je,e as He,a as Ke,b as Xe,l as Ye,f as Ze,g as el,m as ll,r as ye}from"./index-DxTXVRGM.js";import{u as ol,_ as tl}from"./vcode-FZFEZBMq.js";const nl={class:"flex flex-column flex-y-center"},sl={class:"text-white"},al={key:0,class:"h10 text-grey text-center mt-2"},rl=K({__name:"index",props:{url:{},check:{},size:{default:200}},emits:["success"],setup(X,{emit:c}){const{t:y}=$e(),w=X,l=c,L=S({id:""}),F=S();Be(()=>{u()});let m;const v=S(),u=()=>{m&&(clearInterval(m),m=void 0),E.value=void 0,k.get(w.url).then(s=>{s.code===200?(L.value.id=s.data.id,F.value=s.data.qrcode,s.data.expire&&(v.value=s.data.expire,m=setInterval(()=>{v.value--,v.value||q(y("message.qrcodeExpireContent"))},1e3))):q(s.msg)}).catch(()=>{q(y("message.getQrcodeFail"))})};let C;const n=k.axios.CancelToken;let h;const N=()=>{C&&(clearTimeout(C),h&&h.cancel(y("message.userCannel"))),C=void 0,h=n.source(),k.post(w.check,L.value,{cancelToken:h.token}).then(s=>{h=void 0,s.code===k.ResponseCode.SUCCESS?l("success",s):s.code===k.ResponseCode.WAIT?C=setTimeout(()=>{N()},1e3):q(s.msg)}).catch(s=>{var V,R;s.code!="ERR_CANCELED"&&je({code:s.code,msg:s.message,data:{method:(V=s.config)==null?void 0:V.method,url:(R=s.config)==null?void 0:R.url}})})},E=S(),q=s=>{m&&(clearInterval(m),m=void 0),v.value=void 0,E.value=s};return Ue(()=>{C&&clearTimeout(C),m&&clearInterval(m),h&&h.cancel(y("message.userCannel"))}),(s,V)=>{const R=Ge,M=Ee("CircleClose"),P=we,j=qe;return r(),g("div",nl,[i("div",{class:"qrcode",style:Ce([`width:${w.size}px;height:${w.size}px;`])},[a(R,{text:e(F),size:Number(w.size),onUpdate:N},null,8,["text","size"]),i("div",{class:H(["error flex flex-column flex-center grid-gap-4",{show:e(E)}])},[a(P,{size:"40",color:"var(--el-color-danger)"},{default:d(()=>[a(M)]),_:1}),i("div",sl,_(e(E)),1),a(j,{type:"primary",onClick:u,underline:"never"},{default:d(()=>[U(_(e(y)("button.retryText")),1)]),_:1})],2)],4),e(v)?(r(),g("div",al,_(e(y)("message.qrcodeWillExpireContent",{time:e(v)})),1)):p("",!0)])}}}),cl=Oe(rl,[["__scopeId","data-v-c05c31eb"]]),il={class:"login-mask"},ul={class:"languare pointer px-3 flex flex-center"},dl={class:"flex flex-column languare-list"},gl=["onClick"],_l={class:"flex flex-1 flex-center"},ml={key:0,class:"login-image mr-10"},pl=["src"],fl={class:"text-center p-5"},vl={class:"flex flex-center pb-4"},hl={class:"h10 pt-3"},xl={key:1,class:"flex-1 flex flex-column"},bl={class:"flex-1 py-5 w-60 mx-auto flex flex-center flex-column"},kl={class:"px-3"},yl={class:"p-4 flex flex-center mb-10"},Cl={class:"login-button"},wl={key:2,class:"flex-1"},El={key:0,class:"h10 text-center mt-4 mb-10"},ql={key:3,class:"py-4 flex flex-center text-info"},Tl={key:4,class:"py-4 flex flex-center text-dark"},Il={class:"bg-filter bg-mask-light"},Rl=K({name:"/login"}),Bl=K({...Rl,setup(X){var Y;const{t:c}=Je.global,{setUserInfo:y}=He(),w=Ke(),{WEBCONFIG:l}=Xe(w),{isDisabled:L,vcodeText:F,getVcode:m}=ol(),v=S(),u=be({username:"",password:"",vcode:"",token:"",captcha:""}),C=be({username:[{required:!0,message:c("login.rules.username"),trigger:"blur"}],password:[{required:!0,message:c("login.rules.password"),trigger:"blur"}],captcha:[{required:!0,message:c("login.rules.captcha"),trigger:"blur"}]}),n=S((Y=l.value.login)==null?void 0:Y.url);Le(()=>{var t,o,x,b,T,I;(t=l.value.login)!=null&&t.url?n.value=(o=l.value.login)==null?void 0:o.url:(x=l.value.vcode)!=null&&x.url?n.value=(b=l.value.vcode)==null?void 0:b.url:(T=l.value.qrcode_login)!=null&&T.url&&(n.value=(I=l.value.qrcode_login)==null?void 0:I.url)});const h=()=>{var t;(t=v.value)==null||t.validate(o=>{o?k.post(n.value,u).then(x=>{M(x)}):G.error(c("form.rules.warning"))})},N=t=>{u.token=t,u.captcha=""},{BgImage:E,Image:q}=Ye(),s=ke(()=>{var o;let t=c("login.usernamePlaceholder");return n.value===((o=l.value.vcode)==null?void 0:o.url)&&(t=c("login.phonePlaceholder")),t}),V=ke(()=>{var o;let t=c("login.label.username");return n.value===((o=l.value.vcode)==null?void 0:o.url)&&(t=c("login.label.phone")),t}),R=()=>{var t,o,x,b,T,I;n.value===((t=l.value.qrcode_login)==null?void 0:t.url)?(o=l.value.login)!=null&&o.url?n.value=(x=l.value.login)==null?void 0:x.url:(b=l.value.vcode)!=null&&b.url&&(n.value=(T=l.value.vcode)==null?void 0:T.url):n.value=(I=l.value.qrcode_login)==null?void 0:I.url},M=t=>{t.code===k.ResponseCode.SUCCESS?(G.success(t.msg),y(t.data).then(()=>{ye.push(ye.currentRoute.value.query.redirect??"/")}).catch(o=>{G.info(o)})):t.code===k.ResponseCode.REDIRECT_CONFIRM?Qe.confirm(t.msg,c("message.tips"),{confirmButtonText:t.data.confirmButtonText||c("message.redirectText"),cancelButtonText:c("message.cancelText"),type:"warning"}).then(()=>{globalThis.location.href=t.data.url}):t.code===k.ResponseCode.REDIRECT?globalThis.location.href=t.data.url:G.info(t.msg)},P=Ze(),j=t=>{P.setState("language",t),document.documentElement.setAttribute("lang",t),We(()=>{globalThis.location.reload()})};return(t,o)=>{const x=el,b=we,T=Fe,I=Ee("Monitor"),Te=ll,A=De,D=Ae,Ie=tl,Q=qe,Re=cl,Se=Me,Ve=ze;return r(),g("div",{class:"login",style:Ce([e(E)?`backgroundImage:url(${e(E)})`:""])},[o[9]||(o[9]=i("div",{class:"login-bg"},null,-1)),i("div",il,[i("div",ul,[a(T,{placement:"bottom-end"},{reference:d(()=>[a(b,{size:"20"},{default:d(()=>[a(x)]),_:1})]),default:d(()=>[i("div",dl,[(r(!0),g(J,null,Pe(e(P).LANGUARE,(z,W)=>(r(),g("span",{class:"languare-item",onClick:O=>j(z.value),key:W},_(z.label),9,gl))),128))])]),_:1})]),i("div",_l,[e(q)?(r(),g("div",ml,[i("img",{src:e(q),alt:"logo",class:"login-image"},null,8,pl)])):p("",!0),a(Se,{ref_key:"loginFormRef",ref:v,model:e(u),rules:e(C),class:"login-form bg-filter","label-position":"top","hide-required-asterisk":"","show-message":!1,onSubmit:Ne(h,["prevent"])},{default:d(()=>{var z,W,O,Z,ee,le,oe,te,ne,se,ae,re,ce,ie,ue,de,ge,_e,me,pe,fe,ve,he,xe;return[(z=e(l).qrcode_login)!=null&&z.enable?(r(),g("div",{key:0,class:"qrcode-icon",onClick:R},[e(n)===((W=e(l).qrcode_login)==null?void 0:W.url)&&((O=e(l).login)!=null&&O.enable||(Z=e(l).vcode)!=null&&Z.enable)?(r(),B(b,{key:0,size:"20"},{default:d(()=>[a(I)]),_:1})):(r(),B(b,{key:1,size:"20",color:"var(--el-color-primary)"},{default:d(()=>[a(Te)]),_:1}))])):p("",!0),i("div",fl,[i("div",vl,[(ee=e(l).login)!=null&&ee.enable?(r(),g("div",{key:0,class:H(["h8 font-weight-600 mr-4 pointer nav-item",{active:e(n)===((le=e(l).login)==null?void 0:le.url)}]),onClick:o[0]||(o[0]=f=>{var $;return n.value=($=e(l).login)==null?void 0:$.url})},_((oe=e(l).login)==null?void 0:oe.title),3)):p("",!0),(te=e(l).vcode)!=null&&te.enable?(r(),g("div",{key:1,class:H(["h8 font-weight-600 ml-4 pointer nav-item",{active:e(n)===((ne=e(l).vcode)==null?void 0:ne.url)}]),onClick:o[1]||(o[1]=f=>{var $;return n.value=($=e(l).vcode)==null?void 0:$.url})},_((se=e(l).vcode)==null?void 0:se.title),3)):p("",!0)]),i("div",hl,_(e(l).web_title),1)]),e(n)!=((ae=e(l).qrcode_login)==null?void 0:ae.url)?(r(),g("div",xl,[i("div",bl,[a(D,{label:e(V),class:"w-100",prop:"username"},{default:d(()=>[a(A,{modelValue:e(u).username,"onUpdate:modelValue":o[2]||(o[2]=f=>e(u).username=f),placeholder:e(s),size:"large"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(n)===((re=e(l).login)==null?void 0:re.url)?(r(),B(D,{key:0,label:e(c)("login.label.password"),class:"w-100",prop:"password"},{default:d(()=>[a(A,{modelValue:e(u).password,"onUpdate:modelValue":o[3]||(o[3]=f=>e(u).password=f),type:"password",placeholder:e(c)("login.passwordPlaceholder"),size:"large"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):p("",!0),e(n)===((ce=e(l).vcode)==null?void 0:ce.url)||e(n)===((ie=e(l).login)==null?void 0:ie.url)&&((ue=e(l).login)!=null&&ue.captcha)?(r(),B(D,{key:1,label:e(c)("login.label.captcha"),class:"w-100",prop:"captcha"},{default:d(()=>[a(A,{modelValue:e(u).captcha,"onUpdate:modelValue":o[4]||(o[4]=f=>e(u).captcha=f),placeholder:e(c)("login.captchaPlaceholder"),size:"large"},{append:d(()=>[a(Ie,{onChange:N,bg:"52,52,52"})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):p("",!0),e(n)===((de=e(l).vcode)==null?void 0:de.url)?(r(),B(D,{key:2,label:e(c)("login.label.vcode"),class:"w-100",prop:"vcode"},{default:d(()=>[a(A,{modelValue:e(u).vcode,"onUpdate:modelValue":o[6]||(o[6]=f=>e(u).vcode=f),placeholder:e(c)("login.vcodePlaceholder"),size:"large",maxlength:"6"},{append:d(()=>[i("div",kl,[a(Q,{onClick:o[5]||(o[5]=f=>e(m)({username:e(u).username,token:e(u).token,captcha:e(u).captcha,scene:"login"})),type:e(L)?"info":"primary",target:"_blank",underline:"never",class:"line-height-5"},{default:d(()=>[U(_(e(F)),1)]),_:1},8,["type"])])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):p("",!0)]),i("div",yl,[i("button",Cl,_(e(c)("button.loginText")),1)])])):(r(),g("div",wl,[a(Re,{url:(ge=e(l).qrcode_login)==null?void 0:ge.url,check:(_e=e(l).qrcode_login)==null?void 0:_e.check,onSuccess:M},null,8,["url","check"]),(me=e(l).qrcode_login)!=null&&me.title?(r(),g("div",El,_((pe=e(l).qrcode_login)==null?void 0:pe.title),1)):p("",!0)])),(fe=e(l).register)!=null&&fe.enable?(r(),g("div",ql,[a(Q,{href:"#/register",type:"primary",underline:"never"},{default:d(()=>[U(_(e(l).register.link_text),1)]),_:1})])):p("",!0),(ve=e(l).login)!=null&&ve.user_agreement?(r(),g("div",Tl,[e(l).login.user_agreement_config?(r(),g(J,{key:0},[i("span",null,_(e(l).login.user_agreement_config.label),1),a(Q,{href:(he=e(l).login)==null?void 0:he.user_agreement,type:"primary",target:"_blank",underline:"never"},{default:d(()=>[U(_(e(l).login.user_agreement_config.title),1)]),_:1},8,["href"])],64)):(r(),g(J,{key:1},[o[8]||(o[8]=i("span",null,'点击"登录"即代表你已阅读并同意',-1)),a(Q,{href:(xe=e(l).login)==null?void 0:xe.user_agreement,type:"primary",target:"_blank",underline:"never"},{default:d(()=>o[7]||(o[7]=[U("《用户协议》")])),_:1,__:[7]},8,["href"])],64))])):p("",!0)]}),_:1},8,["model","rules"])]),i("div",Il,[a(Ve,{class:"flex-y-center"})])])],4)}}});export{Bl as default};
