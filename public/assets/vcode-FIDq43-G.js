import{i,a as C,k as _}from"./index-BVvACDbh.js";import{g as S,s as b,r as l,o as E,e as T,n as k,u as p,f as x,a as B,E as v}from"./vendor-DUfhs1bh.js";const I=["src","title"],D=S({__name:"index",props:{bg:{default:"255,255,255"}},emits:["change"],setup(d,{emit:r}){const{t:e}=b(),n=d,t=l();E(()=>{s()});const o=r,s=()=>{i.get("captcha/captchaCode",{params:{bg:n.bg,t:Date.now()}}).then(a=>{a.code===i.ResponseCode.SUCCESS&&(t.value=a.data.imag,o("change",a.data.token))})};return(a,g)=>p(t)?(x(),T("img",{key:0,src:p(t),title:p(e)("form.captcha.tips"),onClick:s,class:"pointer"},null,8,I)):k("",!0)}}),{t:h}=_.global,V=d=>{const{WEBCONFIG:r}=C();let e={url:r.apis.vcode,time:60,method:"POST",message:!0};e=Object.assign(e,{}),B(()=>{m()});const n=l(h("form.vcode.vcodeText")),t=l(!1);let o;const s=l(e.time),a=f=>{if(t.value)return;let c;e.method.toLocaleUpperCase()==="POST"?c=i.post(e.url,f):c=i.get(e.url,{params:f}),c==null||c.then(u=>{u.code===i.ResponseCode.SUCCESS?(v.success(u.msg),g()):v.info(u.msg)})},g=()=>{t.value=!0,o=setInterval(()=>{s.value--,s.value<=0?m():n.value=s.value+"s"},1e3)},m=()=>{o&&globalThis.clearInterval(o),o=void 0,t.value=!1,s.value=e.time,n.value=h("form.vcode.vcodeText")};return{isDisabled:t,vcodeText:n,getVcode:a,clear:m}};export{D as _,V as u};
