import{_ as Ce}from"./copyright-ce43e43b.js";import{f as W,r as I,o as we,a as Ee,W as fe,d as i,e as u,A as r,x as c,u as e,B as Q,w as d,t as V,G as F,aV as ge,v as m,K as ve,ab as he,aW as me,V as qe,ac as Ve,C as Ie,T as Re,h as z,E as M,Y as Te,R as ze,Q as Be}from"./vendor-c2b895a9.js";import{h as x,s as Se,i as $e,d as Ue,e as Ne,a as Me,b as Fe,j as De,r as pe,k as Le}from"./index-67af675f.js";import{u as Qe,_ as We}from"./vcode-fdeaafad.js";const Ae={class:"flex flex-column flex-y-center"},Ge={class:"text-white"},Oe={key:0,class:"h10 text-grey text-center mt-2"},je=W({__name:"index",props:{url:{},check:{},size:{default:200}},emits:["success"],setup(A,{emit:D}){const b=A,o=D,B=I({id:""}),S=I();we(()=>{a()});let _;const g=I(),a=()=>{_&&(clearInterval(_),_=void 0),C.value=void 0,x.get(b.url).then(s=>{s.code===200?(B.value.id=s.data.id,S.value=s.data.qrcode,s.data.expire&&(g.value=s.data.expire,_=setInterval(()=>{g.value--,g.value||w("二维码已过期")},1e3))):w(s.msg)}).catch(()=>{w("获取二维码失败")})};let k;const n=x.axios.CancelToken;let v;const $=()=>{k&&(clearTimeout(k),v&&v.cancel("用户取消")),k=void 0,v=n.source(),x.post(b.check,B.value,{cancelToken:v.token}).then(s=>{v=void 0,s.code===x.ResponseCode.SUCCESS?o("success",s):s.code===x.ResponseCode.WAIT?k=setTimeout(()=>{$()},1e3):w(s.msg)}).catch(s=>{var R,E;s.code!="ERR_CANCELED"&&Se({code:s.code,msg:s.message,data:{method:(R=s.config)==null?void 0:R.method,url:(E=s.config)==null?void 0:E.url}})})},C=I(),w=s=>{_&&(clearInterval(_),_=void 0),g.value=void 0,C.value=s};return Ee(()=>{k&&clearTimeout(k),_&&clearInterval(_),v&&v.cancel("用户取消")}),(s,R)=>{const E=$e,U=fe("CircleClose"),t=ve,l=he;return i(),u("div",Ae,[r("div",{class:"qrcode",style:ge([`width:${b.size}px;height:${b.size}px;`])},[c(E,{text:e(S),size:Number(b.size),onUpdate:$},null,8,["text","size"]),r("div",{class:Q(["error flex flex-column flex-center grid-gap-4",{show:e(C)}])},[c(t,{size:"40",color:"var(--el-color-danger)"},{default:d(()=>[c(U)]),_:1}),r("div",Ge,V(e(C)),1),c(l,{type:"primary",onClick:a,underline:!1},{default:d(()=>[F("点击重试")]),_:1})],2)],4),e(g)?(i(),u("div",Oe,"二维码将在"+V(e(g))+"秒后过期",1)):m("",!0)])}}});const Ke=Ue(je,[["__scopeId","data-v-b58c8126"]]),Pe=r("div",{class:"login-bg"},null,-1),Ye={class:"login-mask"},He={class:"flex flex-1 flex-center"},Je={key:0,class:"login-image mr-10"},Xe=["src"],Ze={class:"text-center p-5"},eo={class:"flex flex-center pb-4"},oo={class:"h10 pt-3"},lo={key:1,class:"flex-1 flex flex-column"},to={class:"flex-1 py-5 w-60 mx-auto flex flex-center flex-column"},so={class:"px-3"},no=r("div",{class:"p-4 flex flex-center mb-10"},[r("button",{class:"login-button"},"登录")],-1),ao={key:2,class:"flex-1"},co={key:0,class:"h10 text-center mt-4 mb-10"},io={key:3,class:"py-4 flex flex-center text-info"},ro={key:4,class:"py-4 flex flex-center text-dark"},uo=r("span",null,"点击“登录”即代表你已阅读并同意",-1),_o={class:"bg-filter bg-mask-light"},mo=W({name:"/login"}),ho=W({...mo,setup(A){var U;const{setUserInfo:D}=Ne(),b=Me(),{WEBCONFIG:o}=Fe(b),{isDisabled:B,vcodeText:S,getVcode:_}=Qe(),g=I(),a=me({username:"",password:"",vcode:"",token:"",captcha:""}),k=me({username:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],captcha:[{required:!0,message:"请输入图形验证码",trigger:"blur"}]}),n=I((U=o.value.login)==null?void 0:U.url);qe(()=>{var t,l,h,y,q,p;(t=o.value.login)!=null&&t.url?n.value=(l=o.value.login)==null?void 0:l.url:(h=o.value.vcode)!=null&&h.url?n.value=(y=o.value.vcode)==null?void 0:y.url:(q=o.value.qrcode_login)!=null&&q.url&&(n.value=(p=o.value.qrcode_login)==null?void 0:p.url)});const v=()=>{var t;(t=g.value)==null||t.validate(l=>{l?x.post(n.value,a).then(h=>{E(h)}):M.error("请将表单填写完整")})},$=t=>{a.token=t,a.captcha=""},{BgImage:C,Image:w}=De(),s=Ve(()=>{var l;let t="手机号/用户名";return n.value===((l=o.value.vcode)==null?void 0:l.url)&&(t="手机号"),t}),R=()=>{var t,l,h,y,q,p;n.value===((t=o.value.qrcode_login)==null?void 0:t.url)?(l=o.value.login)!=null&&l.url?n.value=(h=o.value.login)==null?void 0:h.url:(y=o.value.vcode)!=null&&y.url&&(n.value=(q=o.value.vcode)==null?void 0:q.url):n.value=(p=o.value.qrcode_login)==null?void 0:p.url},E=t=>{t.code===x.ResponseCode.SUCCESS?(M.success(t.msg),D(t.data).then(()=>{pe.push(pe.currentRoute.value.query.redirect??"/")}).catch(l=>{M.info(l)})):t.code===x.ResponseCode.REDIRECT_CONFIRM?Te.confirm(t.msg,"提示",{confirmButtonText:t.data.confirmButtonText||"跳转",cancelButtonText:"取消",type:"warning"}).then(()=>{globalThis.location.href=t.data.url}):t.code===x.ResponseCode.REDIRECT?globalThis.location.href=t.data.url:M.info(t.msg)};return(t,l)=>{const h=fe("Monitor"),y=ve,q=Le,p=ze,N=Be,xe=We,L=he,ke=Ke,ye=Re,be=Ce;return i(),u("div",{class:"login",style:ge([e(C)?`backgroundImage:url(${e(C)})`:""])},[Pe,r("div",Ye,[r("div",He,[e(w)?(i(),u("div",Je,[r("img",{src:e(w),alt:"logo",class:"login-image"},null,8,Xe)])):m("",!0),c(ye,{ref_key:"loginFormRef",ref:g,model:e(a),rules:e(k),class:"login-form bg-filter","label-position":"top","hide-required-asterisk":"","show-message":!1,onSubmit:Ie(v,["prevent"])},{default:d(()=>{var G,O,j,K,P,Y,H,J,X,Z,ee,oe,le,te,se,ne,ae,ce,ie,re,de,ue,_e;return[(G=e(o).qrcode_login)!=null&&G.enable?(i(),u("div",{key:0,class:"qrcode-icon",onClick:R},[e(n)===((O=e(o).qrcode_login)==null?void 0:O.url)&&((j=e(o).login)!=null&&j.enable||(K=e(o).vcode)!=null&&K.enable)?(i(),z(y,{key:0,size:"20"},{default:d(()=>[c(h)]),_:1})):(i(),z(y,{key:1,size:"20",color:"var(--el-color-primary)"},{default:d(()=>[c(q)]),_:1}))])):m("",!0),r("div",Ze,[r("div",eo,[(P=e(o).login)!=null&&P.enable?(i(),u("div",{key:0,class:Q(["h8 font-weight-600 mr-4 pointer nav-item",{active:e(n)===((Y=e(o).login)==null?void 0:Y.url)}]),onClick:l[0]||(l[0]=f=>{var T;return n.value=(T=e(o).login)==null?void 0:T.url})},V((H=e(o).login)==null?void 0:H.title),3)):m("",!0),(J=e(o).vcode)!=null&&J.enable?(i(),u("div",{key:1,class:Q(["h8 font-weight-600 ml-4 pointer nav-item",{active:e(n)===((X=e(o).vcode)==null?void 0:X.url)}]),onClick:l[1]||(l[1]=f=>{var T;return n.value=(T=e(o).vcode)==null?void 0:T.url})},V((Z=e(o).vcode)==null?void 0:Z.title),3)):m("",!0)]),r("div",oo,V(e(o).web_title),1)]),e(n)!=((ee=e(o).qrcode_login)==null?void 0:ee.url)?(i(),u("div",lo,[r("div",to,[c(N,{label:"账号",class:"w-100",prop:"username"},{default:d(()=>[c(p,{modelValue:e(a).username,"onUpdate:modelValue":l[2]||(l[2]=f=>e(a).username=f),placeholder:e(s),size:"large"},null,8,["modelValue","placeholder"])]),_:1}),e(n)===((oe=e(o).login)==null?void 0:oe.url)?(i(),z(N,{key:0,label:"密码",class:"w-100",prop:"password"},{default:d(()=>[c(p,{modelValue:e(a).password,"onUpdate:modelValue":l[3]||(l[3]=f=>e(a).password=f),type:"password",placeholder:"密码",size:"large"},null,8,["modelValue"])]),_:1})):m("",!0),e(n)===((le=e(o).vcode)==null?void 0:le.url)||e(n)===((te=e(o).login)==null?void 0:te.url)&&((se=e(o).login)!=null&&se.captcha)?(i(),z(N,{key:1,label:"图形验证码",class:"w-100",prop:"captcha"},{default:d(()=>[c(p,{modelValue:e(a).captcha,"onUpdate:modelValue":l[4]||(l[4]=f=>e(a).captcha=f),placeholder:"图形验证码",size:"large"},{append:d(()=>[c(xe,{onChange:$,bg:"52,52,52"})]),_:1},8,["modelValue"])]),_:1})):m("",!0),e(n)===((ne=e(o).vcode)==null?void 0:ne.url)?(i(),z(N,{key:2,label:"短信验证码",class:"w-100",prop:"vcode"},{default:d(()=>[c(p,{modelValue:e(a).vcode,"onUpdate:modelValue":l[6]||(l[6]=f=>e(a).vcode=f),placeholder:"短信验证码",size:"large",maxlength:"6"},{append:d(()=>[r("div",so,[c(L,{onClick:l[5]||(l[5]=f=>e(_)({username:e(a).username,token:e(a).token,captcha:e(a).captcha,scene:"login"})),type:e(B)?"info":"primary",target:"_blank",underline:!1,class:"line-height-5"},{default:d(()=>[F(V(e(S)),1)]),_:1},8,["type"])])]),_:1},8,["modelValue"])]),_:1})):m("",!0)]),no])):(i(),u("div",ao,[c(ke,{url:(ae=e(o).qrcode_login)==null?void 0:ae.url,check:(ce=e(o).qrcode_login)==null?void 0:ce.check,onSuccess:E},null,8,["url","check"]),(ie=e(o).qrcode_login)!=null&&ie.title?(i(),u("div",co,V((re=e(o).qrcode_login)==null?void 0:re.title),1)):m("",!0)])),(de=e(o).register)!=null&&de.enable?(i(),u("div",io,[c(L,{href:"#/register",type:"primary",underline:!1},{default:d(()=>[F("还没有账号？点击免费注册")]),_:1})])):m("",!0),(ue=e(o).login)!=null&&ue.user_agreement?(i(),u("div",ro,[uo,c(L,{href:(_e=e(o).login)==null?void 0:_e.user_agreement,type:"primary",target:"_blank",underline:!1},{default:d(()=>[F("《用户协议》")]),_:1},8,["href"])])):m("",!0)]}),_:1},8,["model","rules"])]),r("div",_o,[c(be,{class:"flex-y-center"})])])],4)}}});export{ho as default};
