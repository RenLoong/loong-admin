import{h as c,a as h}from"./index-cdfbd549.js";import{f as C,r as l,o as _,u as g,d as S,e as b,l as E,a as k,E as f}from"./vendor-72f7111e.js";const T=["src"],O=C({__name:"index",props:{bg:{default:"255,255,255"}},emits:["change"],setup(i,{emit:r}){const e=i,s=l();_(()=>{a()});const o=r,a=()=>{c.get("captcha/captchaCode",{params:{bg:e.bg,t:Date.now()}}).then(t=>{t.code===c.ResponseCode.SUCCESS&&(s.value=t.data.imag,o("change",t.data.token))})};return(t,p)=>g(s)?(S(),b("img",{key:0,src:g(s),title:"点击切换验证码",onClick:a,class:"pointer"},null,8,T)):E("",!0)}}),U=i=>{const{WEBCONFIG:r}=h();let e={url:r.apis.vcode,time:60,method:"POST",message:!0};e=Object.assign(e,i??{}),k(()=>{m()});const s=l("获取验证码"),o=l(!1);let a;const t=l(e.time),p=d=>{if(o.value)return;let n;e.method.toLocaleUpperCase()==="POST"?n=c.post(e.url,d):n=c.get(e.url,{params:d}),n==null||n.then(u=>{u.code===c.ResponseCode.SUCCESS?(f.success(u.msg),v()):f.info(u.msg)})},v=()=>{o.value=!0,a=setInterval(()=>{t.value--,t.value<=0?m():s.value=t.value+"s"},1e3)},m=()=>{a&&globalThis.clearInterval(a),a=void 0,o.value=!1,t.value=e.time,s.value="获取验证码"};return{isDisabled:o,vcodeText:s,getVcode:p,clear:m}};export{O as _,U as u};
